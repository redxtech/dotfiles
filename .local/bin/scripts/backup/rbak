#!/usr/bin/env sh

# script to manage backup operations
main () {
    # set lockfile path
    RBAK_LOCKFILE="$HOME/.rbak.lock"

    # exit if the lockfile exists
    if test -f "$RBAK_LOCKFILE"; then
        echo "rbak is already running"
        return 1
    fi

    # create the lockfile
    touch "$RBAK_LOCKFILE"

    # tmux new-window rclone copy \
        # --progress \
        # --update \
        # --skip-links \
        # --transfers 30 \
        # --checkers 8 \
        # --contimeout 60s \
        # --timeout 300s \
        # --retries 3 \
        # --low-level-retries 10 \
        # --stats 1s \
        # "$1" "backup:$2"

    # killrbak
    rm "$RBAK_LOCKFILE"

    return 0
}

main "$@"

