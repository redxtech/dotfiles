#!/usr/bin/env sh
    
# logging function
logger () {
    echo "$@" >> "$HOME/.sonarr-sync.log"
}

# main function
main () {
    # set lockfile path
    SS_LOCKFILE="$HOME/.sonarr-sync.lock"

    # exit if the lockfile exists
    if test -f "$SS_LOCKFILE"; then
        echo "sonarr-sync is already running"
        return 1
    fi

    # create the lockfile
    touch "$SS_LOCKFILE"

    # set a variable for the remote
    REMOTE="sonarr"

    # if a param is specified use the second remote
    if test -n "$1"; then
        REMOTE="sonarr3"
    fi

    # log that it has started
    logger "Syncing ($(date "+%Y/%m/%d %H:%M"))..."

    # sync the folders
    rclone sync -P "$REMOTE:/sonarr-lw829/" "$HOME/media/sonarr/" --config="$HOME/.config/rclone/rclone.conf" --transfers=50 --bwlimit 5M

    # log that it is finished
    logger "Syncing completed."

    # remove the lockfile
    rm -rf "$SS_LOCKFILE"
}

main "$1"

