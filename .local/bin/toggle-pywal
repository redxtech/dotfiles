#!/usr/bin/env sh

# script to change the theme of certain applications affected by pywal
# in order to easily toggle between pywal theme and any other theme

enable_vim () {
	# comment out current colourscheme and uncomment the wal colourscheme
	sed -i \
		-e "s/^vim\.cmd('colo/-- vim\.cmd('colo/" \
		-e "s/^-- vim.cmd('colo wal')/vim\.cmd('colo wal')/" \
		~/.config/nvim/lua/opts.lua

	# comment out airline theme setting
	sed -i -e 's/^let g:airline_theme/" let g:airline_theme/' ~/.config/nvim/init.vim
}

disable_vim () {
	# comment out the wal colourscheme and uncomment current colourscheme 
	sed -i \
		-e "s/^-- vim\.cmd('colo/vim\.cmd('colo/" \
		-e "s/^vim.cmd('colo wal')/-- vim\.cmd('colo wal')/" \
		~/.config/nvim/lua/opts.lua

	# uncomment airline theme setting
	sed -i -e 's/^let g:airline_theme/" let g:airline_theme/' ~/.config/nvim/init.vim
}

enable_kitty () {
	# comment out current theme and uncomment wal theme
	sed -i \
		-E "s/^include (.+).conf/# include \1.conf/" \
		~/.config/kitty/theme.conf
	sed -i \
		-e "s/^# include ~\/\.cache\/wal\/colors-kitty\.conf/include ~\/.cache\/wal\/colors-kitty\.conf/" \
		~/.config/kitty/theme.conf
}

disable_kitty () {
	# comment out wal theme and uncomment current theme
	sed -i \
		-E "s/^# include (.+).conf/include \1.conf/" \
		~/.config/kitty/theme.conf
	sed -i \
		-e "s/^include ~\/\.cache\/wal\/colors-kitty\.conf/# include ~\/.cache\/wal\/colors-kitty\.conf/" \
		~/.config/kitty/theme.conf
}

enable_zsh () {
	# uncomment wal sequences script
	sed -i \
		-e "s/^# \[\[ -f ~\/.cache\/wal\/sequences \]\]/\[\[ -f ~\/.cache\/wal\/sequences \]\]/" \
		~/.zshrc
}

disable_zsh () {
	# comment out wal sequences script
	sed -i \
		-e "s/^\[\[ -f ~\/.cache\/wal\/sequences \]\]/# \[\[ -f ~\/.cache\/wal\/sequences \]\]/" \
		~/.zshrc
}

# TODO:
# - bspwm
# - discord
# - tmux
# - rofi
# - vscode

# store state
enable_wal () {
	sed -i \
		-e 's/^enabled=false/enabled=true/' \
		~/.config/wal/pywal.conf
}

disable_wal () {
	sed -i \
		-e 's/^enabled=true/enabled=false/' \
		~/.config/wal/pywal.conf
}

# overall enable/disable functions
enable () {
	echo "Enabling pywal theme..."
	enable_vim
	enable_kitty
	enable_zsh
	
	enable_wal
}

disable () {
	echo "Disabling pywal theme..."
	disable_vim
	disable_kitty
	disable_zsh

	disable_wal
}

main () {
	# if specified turn pywal on
	if test "$1" = "on"; then
		enable
	# if specified turn pywal off
	elif test "$1" = "off"; then
		disable
	else
		# detect current status and toggle
		if grep -q 'enabled=true' ~/.config/wal/pywal.conf; then
			disable
		else
			enable
		fi
	fi
}

main $1

