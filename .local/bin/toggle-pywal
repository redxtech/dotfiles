#!/usr/bin/env sh

# script to change the theme of certain applications affected by pywal
# in order to easily toggle between pywal theme and any other theme

# some variables for config file locations
VIM_COLOURSCHEME_FILE="$HOME/.config/nvim/lua/opts.lua"
KITTY_THEME_FILE="$HOME/.config/kitty/theme.conf"
PYWAL_STATUS_FILE="$HOME/.config/wal/pywal.conf"

enable_vim () {
	# comment out current colourscheme and uncomment the wal colourscheme
	sed -i \
		-e "s/^vim\.cmd('colo/-- vim\.cmd('colo/" \
		-e "s/^-- vim.cmd('colo wal')/vim\.cmd('colo wal')/" \
		"$VIM_COLOURSCHEME_FILE"

	# comment out airline theme setting
	sed -i -e 's/^vim\.g\.airline_theme/-- vim\.g.airline_theme/' "$VIM_COLOURSCHEME_FILE"
}

disable_vim () {
	# comment out the wal colourscheme and uncomment current colourscheme 
	sed -i \
		-e "s/^-- vim\.cmd('colo/vim\.cmd('colo/" \
		-e "s/^vim.cmd('colo wal')/-- vim\.cmd('colo wal')/" \
		"$VIM_COLOURSCHEME_FILE"

	# uncomment airline theme setting
	sed -i -e 's/^-- vim\.g\.airline_theme/vim\.g.airline_theme/' "$VIM_COLOURSCHEME_FILE"
}

enable_kitty () {
	# comment out current theme and uncomment wal theme
	sed -i \
		-E "s/^include (.+).conf/# include \1.conf/" \
		"$KITTY_THEME_FILE"
	sed -i \
		-e "s/^# include ~\/\.cache\/wal\/colors-kitty\.conf/include ~\/.cache\/wal\/colors-kitty\.conf/" \
		"$KITTY_THEME_FILE"
}

disable_kitty () {
	# comment out wal theme and uncomment current theme
	sed -i \
		-E "s/^# include (.+).conf/include \1.conf/" \
		"$KITTY_THEME_FILE"
	sed -i \
		-e "s/^include ~\/\.cache\/wal\/colors-kitty\.conf/# include ~\/.cache\/wal\/colors-kitty\.conf/" \
		"$KITTY_THEME_FILE"
}

# TODO:
# - bspwm
# - discord
# - tmux
# - rofi
# - vscode

# store state
enable_wal () {
	sed -i \
		-e 's/^enabled=false/enabled=true/' \
		"$PYWAL_STATUS_FILE"
}

disable_wal () {
	sed -i \
		-e 's/^enabled=true/enabled=false/' \
		"$PYWAL_STATUS_FILE"
}

# overall enable/disable functions
enable () {
	echo "Enabling pywal theme..."
	enable_vim
	enable_kitty
	
	enable_wal
}

disable () {
	echo "Disabling pywal theme..."
	disable_vim
	disable_kitty

	disable_wal
}

main () {
	# if specified turn pywal on
	if test "$1" = "on"; then
		enable
	# if specified turn pywal off
	elif test "$1" = "off"; then
		disable
	else
		# detect current status and toggle
		if grep -q 'enabled=true' "$PYWAL_STATUS_FILE"; then
			disable
		else
			enable
		fi
	fi
}

main $1

