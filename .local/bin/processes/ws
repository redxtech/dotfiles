#!/usr/bin/env sh

# pull in some dependencies
# shellcheck source=../utils/testdeps.sh
. "$HOME/.local/bin/utils/testdeps.sh" || exit 1

# TODO: add args functions in own files to replace current arg parsing

# error logging function
log_err () {
    echo "error: $*"
}

# script to manage nginx webserver daemon operations
main () {
    # test to see if all the dependencies are installed
    if ! testdeps nginx; then
        exit 1
    fi

    # make sure $args exits and has exactly one element
    if test -z "$1"; then
        sudo systemctl status nginx
        return 0
    elif test -n "$2"; then
        log_err "specify only one operation"
        return 1
    fi

    # run the specified systemctl command for nginx
    case $1 in
        start|up) # start
            sudo systemctl start nginx
            ;;
        restart|rs) # restart
            sudo systemctl restart nginx
            ;;
        stop|down|dn) # stop
            sudo systemctl stop nginx
            ;;
        status|info) # status
            sudo systemctl status nginx
            ;;
        enable|setup) # enable
            sudo systemctl --now enable nginx
            ;;
        disable|remove) # diable
            sudo systemctl --now disable nginx
            ;;
        test|t) # test
            sudo nginx -t
            ;;
        *) # default
            echo "error: that operation doesn't exist"
            return 1
            ;;
    esac
}

main "$@"

